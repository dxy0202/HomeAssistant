import{d as v,r,c,w as _,o as d,a as u,t as C,F as g,b as w,e as j,f,g as A,B as N,A as T,E as K,h as E,l as I,i as F,j as P,k as U,m as H,n as O,p as R,q,s as z}from"./vendor.365770c1.js";const J=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}};J();const V=v({props:{data:{type:Object,default(){return{cmd:"",text:""}}}}}),x=u("a",null,"HomeAssistant",-1);function Q(e,t,s,a,n,i){const o=r("a-avatar"),m=r("a-comment");return d(),c(m,null,{author:_(()=>[x]),avatar:_(()=>[u(o,{src:"https://www.home-assistant.io/images/home-assistant-logo.svg",alt:"HomeAssistant"})]),content:_(()=>[u("p",null,C(e.data.text),1)]),_:1})}V.render=Q;var S=v({props:{data:Object},inject:["callService"],methods:{showClick(e){const{entity_id:t}=this.data;t?(this.callService("media_player.play_media",{media_content_type:"video",media_content_id:e.value,entity_id:t}),this.$message.success(`\u6B63\u5728\u64AD\u653E${e.name}`)):this.$message.error("\u8BF7\u5148\u8BBE\u7F6E\u64AD\u653E\u5668")}}});const b=j("data-v-5aeed5f4"),G=b((e,t,s,a,n,i)=>{const o=r("a-card-grid"),m=r("a-card");return d(),c(m,{title:e.data.text,size:"small"},{default:b(()=>[(d(!0),c(g,null,w(e.data.list,(p,h)=>(d(),c(o,{size:"small",style:{width:"25%","text-align":"center"},key:h,onClick:y=>e.showClick(p)},{default:b(()=>[f(C(p.name),1)]),_:2},1032,["onClick"]))),128))]),_:1},8,["title"])});S.render=G;S.__scopeId="data-v-5aeed5f4";const M={props:{data:{type:Object,default(){return{domain:"",value:"",entity_id:"",isAction:!1}}}},data(){return{}},inject:["callService"],methods:{toggleClick(){const{value:e,domain:t,entity_id:s}=this.data;this.callService(`${t}.turn_${e==="on"?"off":"on"}`,{entity_id:s}),this.$message.success("\u5207\u6362\u6210\u529F"),this.$emit("toggle")},triggerClick(){const{domain:e,entity_id:t}=this.data;e==="script"?this.callService(t):e==="automation"&&this.callService("automation.trigger",{entity_id:t}),this.$message.success("\u89E6\u53D1\u6210\u529F"),this.$emit("trigger")},sourceListChange(e){const{domain:t,entity_id:s}=this.data;this.callService("media_player.select_source",{entity_id:s,source:e}),this.$message.success(`\u9009\u62E9\u3010${e}\u3011`)},format_source_list(e){return e.map(t=>({value:t,label:t}))}}},W=f("\u89E6\u53D1"),X={key:3};function Y(e,t,s,a,n,i){const o=r("a-switch"),m=r("a-button"),p=r("a-select");return s.data.isAction&&["input_boolean","light","switch","fan","automation","climate"].includes(s.data.domain)?(d(),c(o,{key:0,checked:s.data.value==="on",onClick:i.toggleClick},null,8,["checked","onClick"])):s.data.isAction&&["script","scene","automation"].includes(s.data.domain)?(d(),c(m,{key:1,type:"link",onClick:i.triggerClick},{default:_(()=>[W]),_:1},8,["onClick"])):s.data.name==="source_list"?(d(),c(p,{key:2,style:{width:"200px"},options:i.format_source_list(s.data.value),onChange:i.sourceListChange},null,8,["options","onChange"])):(d(),c("span",X,C(s.data.value),1))}M.render=Y;var B=v({components:{ActionButton:M},props:{data:{type:Object,default(){return{cmd:"",text:"",list:[]}}},hass:{},load:Function},data(){return{list:[],entity:null}},inject:["callService"],async mounted(){const e=this.data.list;if(this.list=await this.load({entity_list:e}),e.length===1){const t=e[0].split(".")[0];t==="media_player"&&(this.entity={domain:t,entity_id:e[0],volume_level:this.list.find(s=>s.name==="volume_level").value*100})}},methods:{toggleClick(e){e.value=e.value==="on"?"off":"on"},musicEvent({service:e}){const{entity_id:t,volume_level:s}=this.entity;let a={entity_id:t};e==="volume_set"&&(a.volume_level=s/100),this.callService(`media_player.${e}`,a),this.$message.success("\u64CD\u4F5C\u6210\u529F")}}});const Z={key:0,style:{"text-align":"center"}},ee=f("\u4E0A\u4E00\u66F2"),te=f("\u64AD\u653E/\u6682\u505C"),se=f("\u4E0B\u4E00\u66F2");function ne(e,t,s,a,n,i){const o=r("a-button"),m=r("a-space"),p=r("a-slider"),h=r("ActionButton"),y=r("a-list-item"),k=r("a-list");return d(),c(g,null,[e.entity?(d(),c(g,{key:0},[e.entity.domain==="media_player"?(d(),c("div",Z,[u(m,null,{default:_(()=>[u(o,{type:"primary",onClick:t[1]||(t[1]=l=>e.musicEvent({service:"media_previous_track"}))},{default:_(()=>[ee]),_:1}),u(o,{type:"primary",onClick:t[2]||(t[2]=l=>e.musicEvent({service:"media_play_pause"}))},{default:_(()=>[te]),_:1}),u(o,{type:"primary",onClick:t[3]||(t[3]=l=>e.musicEvent({service:"media_next_track"}))},{default:_(()=>[se]),_:1})]),_:1}),u(p,{value:e.entity.volume_level,"onUpdate:value":t[4]||(t[4]=l=>e.entity.volume_level=l),onAfterChange:t[5]||(t[5]=l=>e.musicEvent({service:"volume_set"}))},null,8,["value"])])):A("",!0)],64)):A("",!0),u(k,{bordered:""},{default:_(()=>[(d(!0),c(g,null,w(e.list,(l,$)=>(d(),c(y,{key:$},{actions:_(()=>[u(h,{data:l,onToggle:re=>e.toggleClick(l)},null,8,["data","onToggle"])]),default:_(()=>[f(C(l.name)+" ",1)]),_:2},1024))),128))]),_:1})],64)}B.render=ne;const D={},ae={style:{"text-align":"center",padding:"50px"}};function ie(e,t){const s=r("a-spin");return d(),c("div",ae,[u(s,{size:"large"})])}D.render=ie;var L=v({components:{BarsOutlined:N,AudioOutlined:T,EditOutlined:K,CardMessage:V,CardVideo:S,CardState:B,CardLoading:D},setup:()=>{let e=E([]);return{hass:null,list:e,isVoice:E(!1)}},data(){return{msg:"",loading:!1,options:[],states:[],throttle:I.exports.throttle(()=>{this.sendMsg(this.msg)},2e3,{leading:!1,trailing:!0})}},watch:{msg(e){if(e)if(this.isVoice)this.throttle();else if(e.indexOf("\u6253\u5F00")==0||e.indexOf("\u5173\u95ED")==0||e.indexOf("\u67E5\u770B")==0){const{states:t}=this;let s=[];t.forEach(a=>{const{entity_id:n,attributes:i}=a,o=n.split(".")[0],m=e.substr(0,2),{friendly_name:p}=i;if(p){const h=m+p;(["input_boolean","light","switch","fan","automation","climate"].includes(o)||m==="\u67E5\u770B")&&(e.length>2&&p.includes(e.substr(2))||e.length==2)&&s.push({value:h})}}),this.options=s}else this.options=[]}},provide(){return{callService:this.callService}},created(){this.connect()},methods:{async connect(){let e;try{e=await F({loadTokens(){try{return JSON.parse(localStorage.hassTokens)}catch{}},saveTokens:s=>{localStorage.hassTokens=JSON.stringify(s)}})}catch(s){if(s===P){const a=prompt("\u8BF7\u8F93\u5165\u8981\u8FDE\u63A5\u7684HomeAssistant\u5730\u5740?",location.origin);e=await F({hassUrl:a})}else{alert(`Unknown error: ${s}`);return}}const t=await U({auth:e});location.search.includes("auth_callback=1")&&history.replaceState(null,"",location.pathname),this.hass=t,H(t).then(s=>{console.log("Logged in as",s),t.sendMessagePromise({type:"get_states"}).then(a=>{this.states=a;let n=a.find(m=>m.entity_id==="conversation.voice"),i=new URLSearchParams(location.search),o=n.attributes.version;i.get("ver")!=o?location.search=`?ver=${o}`:this.list.push({name:"CardMessage",cmd:"HomeAssistant\u670D\u52A1\u8FDE\u63A5\u6210\u529F",data:{text:`\u3010${s.name}\u3011\u4F60\u597D\uFF0C\u6B22\u8FCE\u4F7F\u7528\u8BED\u97F3\u5C0F\u52A9\u624B\uFF0C\u5F53\u524D\u7248\u672C${o}`}})})})},async callService(e,t={}){let s=e.split(".");const a=await this.hass.sendMessagePromise({type:"call_service",domain:s[0],service:s[1],service_data:t});return console.log(a),a},async loadData({entity_list:e}){await this.sleep(1);const s=(await this.hass.sendMessagePromise({type:"get_states"})).filter(n=>e.includes(n.entity_id)).map(n=>(n.domain=n.entity_id.split(".")[0],n));let a=[];if(s.length===1){const{attributes:n,state:i,domain:o,entity_id:m}=s[0];a=Object.keys(n).map(p=>({domain:o,entity_id:m,name:p,value:n[p]})),a.unshift({domain:o,entity_id:m,name:n.friendly_name,value:i,isAction:!0})}else a=s.map(n=>({domain:n.domain,entity_id:n.entity_id,name:n.attributes.friendly_name,value:n.state,isAction:!0}));return a},scrollIntoView(){setTimeout(()=>{const e=document.querySelector("#app .ant-card:nth-last-child(2)");e&&e.scrollIntoView({behavior:"smooth"})},500)},sendMsgKeydown(e){const{msg:t,isVoice:s}=this;t&&!s&&this.sendMsg(t)},async sleep(e){return new Promise(t=>{setTimeout(t,e*1e3)})},sendMsg(e){this.options=[],this.msg="";const t={name:"CardLoading",cmd:e,data:{text:"",list:[]}};this.list.push(t),this.loading=!0,this.hass.sendMessagePromise({conversation_id:`${Math.random().toString(16).substr(2,10)}${Math.random().toString(16).substr(2,10)}`,text:e,type:"conversation/process"}).then(({speech:s})=>{t.data.text=s.plain.speech;const a=s.plain.extra_data;a?(a.type==="video"?(t.name="CardVideo",t.data.entity_id=a.entity_id):t.name="CardState",t.data.list=a.data):t.name="CardMessage",this.list[this.list.length-1]=JSON.parse(JSON.stringify(t))}).finally(()=>{this.loading=!1}),this.scrollIntoView()},toggleVoiceClick(){this.isVoice=!this.isVoice},onSelect(e){this.sendMsg(e)}}});const oe={style:{position:"fixed",bottom:"0",left:"0",width:"100%",padding:"10px",background:"white"}};function le(e,t,s,a,n,i){const o=r("a-card"),m=r("AudioOutlined"),p=r("a-tooltip"),h=r("a-input"),y=r("EditOutlined"),k=r("a-auto-complete");return d(),c(g,null,[(d(!0),c(g,null,w(e.list,(l,$)=>(d(),c(o,{size:"small",key:$,title:l.cmd},{default:_(()=>[(d(),c(R(l.name),{data:l.data,hass:e.hass,load:e.loadData},null,8,["data","hass","load"]))]),_:2},1032,["title"]))),128)),u("div",oe,[e.isVoice?(d(),c(h,{key:0,placeholder:"\u8F93\u5165\u6587\u5B57\u540E\u81EA\u52A8\u53D1\u9001",autofocus:"",value:e.msg,"onUpdate:value":t[2]||(t[2]=l=>e.msg=l),valueModifiers:{trim:!0},onKeydown:O(e.sendMsgKeydown,["enter"]),disabled:e.loading},{suffix:_(()=>[u(p,{title:"\u81EA\u52A8\u53D1\u9001"},{default:_(()=>[u("span",{onClick:t[1]||(t[1]=(...l)=>e.toggleVoiceClick&&e.toggleVoiceClick(...l))},[u(m,{style:{color:"rgba(0, 0, 0, 0.45)"}})])]),_:1})]),_:1},8,["value","onKeydown","disabled"])):(d(),c(k,{key:1,value:e.msg,"onUpdate:value":t[4]||(t[4]=l=>e.msg=l),valueModifiers:{trim:!0},options:e.options,onSelect:e.onSelect,"dropdown-class-name":"certain-category-search-dropdown",style:{width:"100%"}},{default:_(()=>[u(h,{placeholder:"\u8BF7\u8F93\u5165\u6587\u5B57\u547D\u4EE4",onKeydown:O(e.sendMsgKeydown,["enter"])},{suffix:_(()=>[u(p,{title:"\u624B\u52A8\u53D1\u9001"},{default:_(()=>[u("span",{onClick:t[3]||(t[3]=(...l)=>e.toggleVoiceClick&&e.toggleVoiceClick(...l))},[u(y,{style:{color:"rgba(0, 0, 0, 0.45)"}})])]),_:1})]),_:1},8,["onKeydown"])]),_:1},8,["value","options","onSelect"]))])],64)}L.render=le;q(L).use(z).mount("#app");
